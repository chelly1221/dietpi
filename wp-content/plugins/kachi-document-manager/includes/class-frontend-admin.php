<?php
/**
 * 3chan PDF Manager Frontend Admin Class
 * ÌîÑÎ°†Ìä∏ÏóîÎìú Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄÎ•º ÏúÑÌïú ÌÅ¥ÎûòÏä§
 */

if (!defined('ABSPATH')) {
    exit;
}

class ThreeChan_PDF_Frontend_Admin {
    
    private $table_name;
    
    public function __construct() {
        global $wpdb;
        $this->table_name = $wpdb->prefix . '3chan_pdf_uploads';
        
        // AJAX Ìï∏Îì§Îü¨
        add_action('wp_ajax_3chan_fa_save_settings', array($this, 'ajax_save_settings'));
        add_action('wp_ajax_3chan_fa_get_documents', array($this, 'ajax_get_documents'));
        add_action('wp_ajax_3chan_fa_delete_documents', array($this, 'ajax_delete_documents'));
        add_action('wp_ajax_3chan_fa_test_api', array($this, 'ajax_test_api'));
        add_action('wp_ajax_3chan_fa_clear_data', array($this, 'ajax_clear_data'));
        
        // Ïä§ÌÅ¨Î¶ΩÌä∏ Î∞è Ïä§ÌÉÄÏùº Îì±Î°ù
        add_action('wp_enqueue_scripts', array($this, 'enqueue_frontend_scripts'));
    }
    
    /**
     * ÌîÑÎ°†Ìä∏ÏóîÎìú Í¥ÄÎ¶¨Ïûê ÏáºÌä∏ÏΩîÎìú Î†åÎçîÎßÅ
     */
    public static function render_admin_shortcode($atts) {
        // Í∂åÌïú ÌôïÏù∏
        if (!current_user_can('manage_options')) {
            return self::render_access_denied();
        }
        
        // Í∏∞Ï°¥ ÏÑ§Ï†ï Í∞ÄÏ†∏Ïò§Í∏∞
        $settings = get_option('3chan_pdf_manager_settings', array());
        $default_settings = array(
            'api_url' => 'http://1.3chan.kr',
            'max_file_size' => 50,
            'allowed_file_types' => array('pdf', 'docx', 'pptx', 'hwpx'),
            'enable_notifications' => true,
            'default_page_size' => 10,
            'primary_color' => '#a70638',
            'enable_auto_save' => true,
            'cache_duration' => 3600,
            'use_proxy' => true,
            'enable_duplicate_check' => true
        );
        $settings = wp_parse_args($settings, $default_settings);
        
        ob_start();
        ?>
        
        <div class="pdf-frontend-admin">
            <div class="pdf-fa-container">
                <!-- Ìó§Îçî ÏòÅÏó≠ (Î°úÍ≥† + ÌÉ≠) -->
                <header class="pdf-fa-header-wrapper">
                    <!-- Î°úÍ≥† ÏÑπÏÖò -->
                    <div class="pdf-fa-logo-section">
                        <a href="#" class="pdf-fa-logo">
                            <div class="pdf-fa-logo-icon">üìÑ</div>
                            <span>PDF Manager</span>
                        </a>
                    </div>
                    
                    <!-- ÏÉÅÎã® ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
                    <nav class="pdf-fa-tabs-nav">
                        <a href="#" class="pdf-fa-tab-item active" data-section="documents">
                            <span class="pdf-fa-tab-icon">üìÅ</span>
                            <span class="pdf-fa-tab-text">Î¨∏ÏÑú Í¥ÄÎ¶¨</span>
                        </a>
                        <a href="#" class="pdf-fa-tab-item" data-section="settings">
                            <span class="pdf-fa-tab-icon">‚öôÔ∏è</span>
                            <span class="pdf-fa-tab-text">ÏÑ§Ï†ï</span>
                        </a>
                        <a href="#" class="pdf-fa-tab-item" data-section="guide">
                            <span class="pdf-fa-tab-icon">‚ùì</span>
                            <span class="pdf-fa-tab-text">ÏÇ¨Ïö© Î∞©Î≤ï</span>
                        </a>
                    </nav>
                </header>
                
                <!-- Î©îÏù∏ ÏòÅÏó≠ -->
                <main class="pdf-fa-main">
                    <!-- ÏïåÎ¶º ÏòÅÏó≠ -->
                    <div class="pdf-fa-notice" style="display:none;"></div>
                    
                    <!-- Î¨∏ÏÑú Í¥ÄÎ¶¨ ÏÑπÏÖò -->
                    <?php self::render_documents_section(); ?>
                    
                    <!-- ÏÑ§Ï†ï ÏÑπÏÖò -->
                    <?php self::render_settings_section($settings); ?>
                    
                    <!-- ÏÇ¨Ïö© Î∞©Î≤ï ÏÑπÏÖò -->
                    <?php self::render_guide_section(); ?>
                </main>
            </div>
        </div>
        
        <?php
        return ob_get_clean();
    }
    
    /**
     * Î¨∏ÏÑú Í¥ÄÎ¶¨ ÏÑπÏÖò Î†åÎçîÎßÅ
     */
    private static function render_documents_section() {
        ?>
        <div class="pdf-fa-section active" data-section="documents">
            <header class="pdf-fa-section-header">
                <div class="pdf-fa-header-left">
                    <h1 class="pdf-fa-title" style="font-size:28px;">Î¨∏ÏÑú Í¥ÄÎ¶¨</h1>
                </div>
                <div class="pdf-fa-header-actions">
                    <button type="button" class="pdf-fa-btn-secondary" id="refresh-documents">
                        <span class="pdf-fa-icon">üîÑ</span>
                        <span>ÏÉàÎ°úÍ≥†Ïπ®</span>
                    </button>
                </div>
            </header>
            
            <div class="pdf-fa-content">
                <!-- Î¨∏ÏÑú ÌÜµÍ≥Ñ -->
                <div class="pdf-fa-stats-grid">
                    <div class="pdf-fa-stat-card">
                        <div class="stat-icon">üìÑ</div>
                        <div class="stat-content">
                            <h3 id="totalDocuments">0</h3>
                            <p>Ï†ÑÏ≤¥ Î¨∏ÏÑú</p>
                        </div>
                    </div>
                    
                    <div class="pdf-fa-stat-card">
                        <div class="stat-icon">üíæ</div>
                        <div class="stat-content">
                            <h3 id="totalSize">0 MB</h3>
                            <p>Ï†ÑÏ≤¥ Ïö©Îüâ</p>
                        </div>
                    </div>
                    
                    <div class="pdf-fa-stat-card">
                        <div class="stat-icon">üè∑Ô∏è</div>
                        <div class="stat-content">
                            <h3 id="totalTags">0</h3>
                            <p>ÌÉúÍ∑∏ Ïàò</p>
                        </div>
                    </div>
                    
                    <div class="pdf-fa-stat-card">
                        <div class="stat-icon">üîÑ</div>
                        <div class="stat-content">
                            <h3 id="apiStatus">ÌôïÏù∏Ï§ë...</h3>
                            <p>API ÏÉÅÌÉú</p>
                        </div>
                    </div>
                </div>
                
                <!-- Î¨∏ÏÑú Î™©Î°ù -->
                <div class="pdf-fa-documents-section">
                    <div class="pdf-fa-section-title">
                        <h3>
                            <span class="pdf-fa-icon">üìã</span>
                            ÏµúÍ∑º ÏóÖÎ°úÎìúÎêú Î¨∏ÏÑú
                        </h3>
                        <button type="button" class="pdf-fa-btn-secondary" id="delete-selected">
                            <span class="pdf-fa-icon">üóëÔ∏è</span>
                            <span>ÏÑ†ÌÉù ÏÇ≠Ï†ú</span>
                        </button>
                    </div>
                    
                    <div class="pdf-fa-documents-list" id="documentsListContainer">
                        <div class="pdf-fa-loading">
                            <div class="loading-spinner"></div>
                            <p>Î¨∏ÏÑú Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Îπ†Î•∏ ÏûëÏóÖ -->
                <div class="pdf-fa-quick-actions">
                    <h3>
                        <span class="pdf-fa-icon">‚ö°</span>
                        Îπ†Î•∏ ÏûëÏóÖ
                    </h3>
                    <div class="quick-actions-grid">
                        <button type="button" class="pdf-fa-btn-secondary" id="clear-all-data">
                            <span class="pdf-fa-icon">üî•</span>
                            <span>Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú</span>
                        </button>
                        <button type="button" class="pdf-fa-btn-secondary" id="test-api-connection">
                            <span class="pdf-fa-icon">üîå</span>
                            <span>API Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <?php
    }
    
    /**
     * ÏÑ§Ï†ï ÏÑπÏÖò Î†åÎçîÎßÅ
     */
    private static function render_settings_section($settings) {
        ?>
        <div class="pdf-fa-section" data-section="settings">
            <header class="pdf-fa-section-header">
                <div class="pdf-fa-header-left">
                    <h1 class="pdf-fa-title" style="font-size:28px;">ÏÑ§Ï†ï</h1>
                </div>
                <div class="pdf-fa-header-actions">
                    <span class="pdf-fa-save-status" style="display: none;">
                        <span class="pdf-fa-icon">‚úÖ</span>
                        <span>ÏûêÎèô Ï†ÄÏû•Îê®</span>
                    </span>
                </div>
            </header>
            
            <div class="pdf-fa-content">
                <form id="pdf-settings-form">
                    <div class="pdf-fa-settings-grid">
                        <!-- API ÏÑ§Ï†ï -->
                        <div class="pdf-fa-setting-card">
                            <h3>
                                <span class="pdf-fa-icon">üîå</span>
                                API ÏÑ§Ï†ï
                            </h3>
                            
                            <div class="pdf-fa-form-group">
                                <label for="api_url">API URL</label>
                                <input type="url" 
                                       id="api_url" 
                                       name="api_url" 
                                       class="pdf-fa-input" 
                                       value="<?php echo esc_url($settings['api_url']); ?>" 
                                       required>
                                <p class="pdf-fa-help-text">Ïô∏Î∂Ä API ÏÑúÎ≤ÑÏùò URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.</p>
                            </div>
                            
                            <div class="pdf-fa-form-group">
                                <label class="pdf-fa-checkbox-label">
                                    <input type="checkbox" 
                                           name="use_proxy" 
                                           value="1" 
                                           <?php checked($settings['use_proxy']); ?>>
                                    <span>WordPress ÌîÑÎ°ùÏãúÎ•º ÌÜµÌï¥ API ÏöîÏ≤≠ (CORS Î¨∏Ï†ú Ìï¥Í≤∞)</span>
                                </label>
                            </div>
                            
                            <div class="pdf-fa-form-group">
                                <label for="cache_duration">Ï∫êÏãú Ïú†Ìö® ÏãúÍ∞Ñ (Ï¥à)</label>
                                <input type="number" 
                                       id="cache_duration" 
                                       name="cache_duration" 
                                       class="pdf-fa-input" 
                                       value="<?php echo esc_attr($settings['cache_duration']); ?>" 
                                       min="0">
                                <p class="pdf-fa-help-text">API ÏùëÎãµ Ï∫êÏãú ÏãúÍ∞Ñ (0 = Ï∫êÏãú ÏÇ¨Ïö© Ïïà Ìï®)</p>
                            </div>
                        </div>
                        
                        <!-- ÌååÏùº ÏóÖÎ°úÎìú ÏÑ§Ï†ï -->
                        <div class="pdf-fa-setting-card">
                            <h3>
                                <span class="pdf-fa-icon">üìÅ</span>
                                ÌååÏùº ÏóÖÎ°úÎìú ÏÑ§Ï†ï
                            </h3>
                            
                            <div class="pdf-fa-form-group">
                                <label for="max_file_size">ÏµúÎåÄ ÌååÏùº ÌÅ¨Í∏∞ (MB)</label>
                                <input type="number" 
                                       id="max_file_size" 
                                       name="max_file_size" 
                                       class="pdf-fa-input" 
                                       value="<?php echo esc_attr($settings['max_file_size']); ?>" 
                                       min="1" 
                                       max="500">
                                <p class="pdf-fa-help-text">
                                    ÏÑúÎ≤Ñ ÏµúÎåÄ ÏóÖÎ°úÎìú ÌÅ¨Í∏∞: <?php echo size_format(wp_max_upload_size()); ?>
                                </p>
                            </div>
                            
                            <div class="pdf-fa-form-group">
                                <label>ÌóàÏö© ÌååÏùº ÌòïÏãù</label>
                                <div class="pdf-fa-checkbox-group">
                                    <label class="pdf-fa-checkbox-label">
                                        <input type="checkbox" 
                                               name="allowed_file_types[]" 
                                               value="pdf" 
                                               <?php checked(in_array('pdf', $settings['allowed_file_types'])); ?>>
                                        <span>PDF</span>
                                    </label>
                                    <label class="pdf-fa-checkbox-label">
                                        <input type="checkbox" 
                                               name="allowed_file_types[]" 
                                               value="docx" 
                                               <?php checked(in_array('docx', $settings['allowed_file_types'])); ?>>
                                        <span>DOCX</span>
                                    </label>
                                    <label class="pdf-fa-checkbox-label">
                                        <input type="checkbox" 
                                               name="allowed_file_types[]" 
                                               value="pptx" 
                                               <?php checked(in_array('pptx', $settings['allowed_file_types'])); ?>>
                                        <span>PPTX</span>
                                    </label>
                                    <label class="pdf-fa-checkbox-label">
                                        <input type="checkbox" 
                                               name="allowed_file_types[]" 
                                               value="hwpx" 
                                               <?php checked(in_array('hwpx', $settings['allowed_file_types'])); ?>>
                                        <span>HWPX</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="pdf-fa-form-group">
                                <label class="pdf-fa-checkbox-label">
                                    <input type="checkbox" 
                                           name="enable_duplicate_check" 
                                           value="1" 
                                           <?php checked($settings['enable_duplicate_check']); ?>>
                                    <span>ÌååÏùº ÏóÖÎ°úÎìú Ïãú Ï§ëÎ≥µ ÌôïÏù∏</span>
                                </label>
                                <p class="pdf-fa-help-text">Í∞ôÏùÄ ÌòÑÏû•(site)ÏóêÏÑú ÎèôÏùºÌïú Ïù¥Î¶ÑÏùò ÌååÏùºÏù¥ ÏûàÏùÑ Í≤ΩÏö∞ ÌôïÏù∏Ìï©ÎãàÎã§.</p>
                            </div>
                        </div>
                        
                        <!-- UI ÏÑ§Ï†ï -->
                        <div class="pdf-fa-setting-card">
                            <h3>
                                <span class="pdf-fa-icon">üé®</span>
                                ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÌéòÏù¥Ïä§
                            </h3>
                            
                            <div class="pdf-fa-form-group">
                                <label for="primary_color">Ï£º ÏÉâÏÉÅ</label>
                                <div class="color-input-group">
                                    <input type="color" 
                                           id="primary_color" 
                                           name="primary_color" 
                                           value="<?php echo esc_attr($settings['primary_color']); ?>">
                                    <span class="color-preview" style="background-color: <?php echo esc_attr($settings['primary_color']); ?>"></span>
                                </div>
                            </div>
                            
                            <div class="pdf-fa-form-group">
                                <label for="default_page_size">ÌéòÏù¥ÏßÄÎãπ Ìï≠Î™© Ïàò</label>
                                <select id="default_page_size" name="default_page_size" class="pdf-fa-input">
                                    <option value="10" <?php selected($settings['default_page_size'], 10); ?>>10</option>
                                    <option value="20" <?php selected($settings['default_page_size'], 20); ?>>20</option>
                                    <option value="30" <?php selected($settings['default_page_size'], 30); ?>>30</option>
                                    <option value="50" <?php selected($settings['default_page_size'], 50); ?>>50</option>
                                    <option value="100" <?php selected($settings['default_page_size'], 100); ?>>100</option>
                                </select>
                            </div>
                            
                            <div class="pdf-fa-form-group">
                                <label class="pdf-fa-checkbox-label">
                                    <input type="checkbox" 
                                           name="enable_notifications" 
                                           value="1" 
                                           <?php checked($settings['enable_notifications']); ?>>
                                    <span>ÏïåÎ¶º Î©îÏãúÏßÄ ÌëúÏãú</span>
                                </label>
                            </div>
                            
                            <div class="pdf-fa-form-group">
                                <label class="pdf-fa-checkbox-label">
                                    <input type="checkbox" 
                                           name="enable_auto_save" 
                                           value="1" 
                                           <?php checked($settings['enable_auto_save']); ?>>
                                    <span>ÏûÖÎ†• ÎÇ¥Ïö© ÏûêÎèô Ï†ÄÏû•</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <?php
    }
    
    /**
     * ÏÇ¨Ïö© Î∞©Î≤ï ÏÑπÏÖò Î†åÎçîÎßÅ
     */
    private static function render_guide_section() {
        ?>
        <div class="pdf-fa-section" data-section="guide">
            <header class="pdf-fa-section-header">
                <div class="pdf-fa-header-left">
                    <h1 class="pdf-fa-title" style="font-size:28px;">ÏÇ¨Ïö© Î∞©Î≤ï</h1>
                </div>
            </header>
            
            <div class="pdf-fa-content">
                <div class="pdf-fa-guide-grid">
                    <!-- PDF Î¨∏ÏÑú ÌëúÏãú -->
                    <div class="pdf-fa-guide-card">
                        <h3>
                            <span class="pdf-fa-icon">üìÑ</span>
                            PDF Î¨∏ÏÑú ÌëúÏãú
                        </h3>
                        <div class="pdf-fa-code-block">
                            <code>[3chan_pdf_manager]</code>
                        </div>
                        <p>ÌéòÏù¥ÏßÄÎÇò Ìè¨Ïä§Ìä∏Ïóê ÏúÑ ÏàèÏΩîÎìúÎ•º ÏÇΩÏûÖÌïòÎ©¥ PDF ÏóÖÎ°úÎìú Î∞è Í¥ÄÎ¶¨ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Í∞Ä ÌëúÏãúÎê©ÎãàÎã§.</p>
                        <ul class="pdf-fa-feature-list">
                            <li>PDF, DOCX, PPTX, HWPX ÌååÏùº ÏßÄÏõê</li>
                            <li>PDF Ïó¨Î∞± ÏÑ§Ï†ï Í∏∞Îä•</li>
                            <li>ÌÉúÍ∑∏ Í∏∞Î∞ò Î¨∏ÏÑú Í¥ÄÎ¶¨</li>
                            <li>ÌéòÏù¥ÏßÄÎ≥Ñ ÎÇ¥Ïö© Í≤ÄÏÉâ</li>
                        </ul>
                    </div>
                    
                    <!-- Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ -->
                    <div class="pdf-fa-guide-card">
                        <h3>
                            <span class="pdf-fa-icon">‚öôÔ∏è</span>
                            Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ
                        </h3>
                        <div class="pdf-fa-code-block">
                            <code>[3chan_pdf_admin]</code>
                        </div>
                        <p>ÌîÑÎ°†Ìä∏ÏóîÎìúÏóêÏÑú PDF ManagerÎ•º Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÎäî Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄÏûÖÎãàÎã§.</p>
                        <ul class="pdf-fa-feature-list">
                            <li>Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌïÑÏöî</li>
                            <li>Î¨∏ÏÑú Î™©Î°ù Í¥ÄÎ¶¨</li>
                            <li>API ÏÑ§Ï†ï</li>
                            <li>UI Ïª§Ïä§ÌÑ∞ÎßàÏù¥Ïßï</li>
                        </ul>
                    </div>
                    
                    <!-- ÌååÏùº ÏóÖÎ°úÎìú Í∞ÄÏù¥Îìú -->
                    <div class="pdf-fa-guide-card">
                        <h3>
                            <span class="pdf-fa-icon">üì§</span>
                            ÌååÏùº ÏóÖÎ°úÎìú
                        </h3>
                        <p>ÌååÏùº ÏóÖÎ°úÎìú Ïãú Îã§Ïùå ÏÇ¨Ìï≠ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî:</p>
                        <ul class="pdf-fa-input-guide">
                            <li><strong>ÌååÏùº ÌòïÏãù:</strong> PDF, DOCX, PPTX, HWPX</li>
                            <li><strong>ÏµúÎåÄ ÌÅ¨Í∏∞:</strong> ÏÑ§Ï†ïÏóêÏÑú ÏßÄÏ†ïÌïú ÌÅ¨Í∏∞ÍπåÏßÄ</li>
                            <li><strong>Ïó¨Îü¨ ÌååÏùº:</strong> ÎèôÏãúÏóê Ïó¨Îü¨ ÌååÏùº ÏóÖÎ°úÎìú Í∞ÄÎä•</li>
                            <li><strong>ÌÉúÍ∑∏ Ï∂îÍ∞Ä:</strong> ÏóÖÎ°úÎìú Ïãú ÌÉúÍ∑∏ ÏûÖÎ†• Í∞ÄÎä•</li>
                            <li><strong>Ï§ëÎ≥µ ÌôïÏù∏:</strong> Í∞ôÏùÄ Ïù¥Î¶ÑÏùò ÌååÏùº ÏûêÎèô ÌôïÏù∏</li>
                        </ul>
                    </div>
                    
                    <!-- API ÏÑ§Ï†ï Í∞ÄÏù¥Îìú -->
                    <div class="pdf-fa-guide-card">
                        <h3>
                            <span class="pdf-fa-icon">üîå</span>
                            API ÏÑ§Ï†ï
                        </h3>
                        <div class="pdf-fa-info-box">
                            <h4>API ÏÑúÎ≤Ñ Ï£ºÏÜå</h4>
                            <p>Í∏∞Î≥∏Í∞í: http://1.3chan.kr</p>
                        </div>
                        <div class="pdf-fa-info-box">
                            <h4>ÌîÑÎ°ùÏãú ÏÇ¨Ïö©</h4>
                            <p>CORS Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌï† Í≤ΩÏö∞ WordPress ÌîÑÎ°ùÏãúÎ•º ÌÜµÌï¥ APIÎ•º Ìò∏Ï∂úÌï©ÎãàÎã§.</p>
                        </div>
                        <div class="pdf-fa-info-box">
                            <h4>Ï∫êÏãú ÏÑ§Ï†ï</h4>
                            <p>API ÏùëÎãµÏùÑ Ï∫êÏãúÌïòÏó¨ ÏÑ±Îä•ÏùÑ Ìñ•ÏÉÅÏãúÌÇ¨ Ïàò ÏûàÏäµÎãàÎã§.</p>
                        </div>
                    </div>
                    
                    <!-- Í∞úÎ∞úÏûê Í∞ÄÏù¥Îìú -->
                    <div class="pdf-fa-guide-card">
                        <h3>
                            <span class="pdf-fa-icon">üíª</span>
                            Í∞úÎ∞úÏûê Í∞ÄÏù¥Îìú
                        </h3>
                        <p>ÏÇ¨Ïö© Í∞ÄÎä•Ìïú PHP Ìï®ÏàòÎì§:</p>
                        <div class="pdf-fa-code-block">
                            <code>threechan_pdf_get_user_files($user_id)</code>
                        </div>
                        <p>ÏÇ¨Ïö©ÏûêÏùò ÏóÖÎ°úÎìúÎêú ÌååÏùº Î™©Î°ùÏùÑ Í∞ÄÏ†∏ÏòµÎãàÎã§.</p>
                        
                        <div class="pdf-fa-code-block">
                            <code>threechan_pdf_update_user_info($user_id, $sosok, $site)</code>
                        </div>
                        <p>ÏÇ¨Ïö©ÏûêÏùò ÏÜåÏÜçÍ≥º ÌòÑÏû• Ï†ïÎ≥¥Î•º ÏóÖÎç∞Ïù¥Ìä∏Ìï©ÎãàÎã§.</p>
                        
                        <div class="pdf-fa-code-block">
                            <code>threechan_pdf_delete_file($file_id)</code>
                        </div>
                        <p>ÌäπÏ†ï ÌååÏùºÏùÑ ÏÇ≠Ï†úÌï©ÎãàÎã§.</p>
                    </div>
                    
                    <!-- Ï£ºÏùòÏÇ¨Ìï≠ -->
                    <div class="pdf-fa-guide-card">
                        <h3>
                            <span class="pdf-fa-icon">‚ö†Ô∏è</span>
                            Ï£ºÏùòÏÇ¨Ìï≠
                        </h3>
                        <div class="pdf-fa-info-box">
                            <h4>Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ</h4>
                            <p>Ï§ëÏöîÌïú Î¨∏ÏÑúÎäî Ï†ïÍ∏∞Ï†ÅÏúºÎ°ú Î∞±ÏóÖÌïòÎäî Í≤ÉÏùÑ Í∂åÏû•Ìï©ÎãàÎã§.</p>
                        </div>
                        <div class="pdf-fa-info-box">
                            <h4>ÌååÏùº ÌÅ¨Í∏∞</h4>
                            <p>ÎåÄÏö©Îüâ ÌååÏùº ÏóÖÎ°úÎìú Ïãú ÏÑúÎ≤Ñ ÏÑ§Ï†ïÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.</p>
                        </div>
                        <div class="pdf-fa-info-box">
                            <h4>Í∂åÌïú Í¥ÄÎ¶¨</h4>
                            <p>Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄÎäî manage_options Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <?php
    }
    
    /**
     * Ï†ëÍ∑º Í±∞Î∂Ä Î©îÏãúÏßÄ
     */
    private static function render_access_denied() {
        return '
        <div class="pdf-fa-access-denied">
            <span class="pdf-fa-icon">üö´</span>
            <h3>Ï†ëÍ∑º Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§</h3>
            <p>Ïù¥ ÌéòÏù¥ÏßÄÎäî Í¥ÄÎ¶¨ÏûêÎßå Ï†ëÍ∑ºÌï† Ïàò ÏûàÏäµÎãàÎã§.</p>
        </div>';
    }
    
    /**
     * ÌîÑÎ°†Ìä∏ÏóîÎìú Ïä§ÌÅ¨Î¶ΩÌä∏ Î∞è Ïä§ÌÉÄÏùº Îì±Î°ù
     */
    public function enqueue_frontend_scripts() {
        global $post;
        
        // ÏáºÌä∏ÏΩîÎìúÍ∞Ä ÏûàÎäî ÌéòÏù¥ÏßÄÏù∏ÏßÄ ÌôïÏù∏
        if (is_a($post, 'WP_Post') && has_shortcode($post->post_content, '3chan_pdf_admin')) {
            // Ïä§ÌÉÄÏùº
            wp_enqueue_style('pdf-frontend-admin', THREECHAN_PDF_PLUGIN_URL . 'assets/css/pdf-frontend-admin.css', array(), THREECHAN_PDF_VERSION);
            
            // Ïä§ÌÅ¨Î¶ΩÌä∏
            wp_enqueue_script('pdf-frontend-admin', THREECHAN_PDF_PLUGIN_URL . 'assets/js/pdf-frontend-admin.js', array('jquery'), THREECHAN_PDF_VERSION, true);
            
            // Localization
            wp_localize_script('pdf-frontend-admin', 'pdf_frontend', array(
                'ajax_url' => admin_url('admin-ajax.php'),
                'nonce' => wp_create_nonce('pdf_frontend_nonce'),
                'messages' => array(
                    'save_success' => 'Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.',
                    'save_error' => 'Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                    'delete_confirm' => 'Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                    'delete_success' => 'ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.',
                    'loading' => 'Î°úÎî© Ï§ë...',
                    'saving' => 'Ï†ÄÏû• Ï§ë...',
                    'saved' => 'ÏûêÎèô Ï†ÄÏû•Îê®',
                    'test_success' => 'API Ïó∞Í≤∞ ÏÑ±Í≥µ!',
                    'test_error' => 'API Ïó∞Í≤∞ Ïã§Ìå®!',
                    'clear_confirm' => 'Ï†ïÎßêÎ°ú Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.',
                    'clear_success' => 'Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.'
                )
            ));
        }
    }
    
    /**
     * AJAX: ÏÑ§Ï†ï Ï†ÄÏû•
     */
    public function ajax_save_settings() {
        // Nonce Í≤ÄÏ¶ù
        if (!check_ajax_referer('pdf_frontend_nonce', 'nonce', false)) {
            wp_send_json_error('Î≥¥Ïïà Í≤ÄÏ¶ù Ïã§Ìå®');
        }
        
        // Í∂åÌïú ÌôïÏù∏
        if (!current_user_can('manage_options')) {
            wp_send_json_error('Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.');
        }
        
        // Parse form data
        parse_str($_POST['form'], $form_data);
        
        $settings = array(
            'api_url' => sanitize_url($form_data['api_url'] ?? ''),
            'max_file_size' => intval($form_data['max_file_size'] ?? 50),
            'allowed_file_types' => array_map('sanitize_text_field', $form_data['allowed_file_types'] ?? array()),
            'enable_notifications' => isset($form_data['enable_notifications']),
            'default_page_size' => intval($form_data['default_page_size'] ?? 10),
            'primary_color' => sanitize_hex_color($form_data['primary_color'] ?? '#a70638'),
            'enable_auto_save' => isset($form_data['enable_auto_save']),
            'cache_duration' => intval($form_data['cache_duration'] ?? 3600),
            'use_proxy' => isset($form_data['use_proxy']),
            'enable_duplicate_check' => isset($form_data['enable_duplicate_check'])
        );
        
        update_option('3chan_pdf_manager_settings', $settings);
        
        wp_send_json_success(array('message' => 'ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.'));
    }
    
    /**
     * AJAX: Î¨∏ÏÑú Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞
     */
    public function ajax_get_documents() {
        // Nonce Í≤ÄÏ¶ù
        if (!check_ajax_referer('pdf_frontend_nonce', 'nonce', false)) {
            wp_send_json_error('Î≥¥Ïïà Í≤ÄÏ¶ù Ïã§Ìå®');
        }
        
        // Í∂åÌïú ÌôïÏù∏
        if (!current_user_can('manage_options')) {
            wp_send_json_error('Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.');
        }
        
        global $wpdb;
        $table_name = $wpdb->prefix . '3chan_pdf_uploads';
        
        // ÌÖåÏù¥Î∏îÏù¥ Ï°¥Ïû¨ÌïòÎäîÏßÄ ÌôïÏù∏
        if ($wpdb->get_var("SHOW TABLES LIKE '$table_name'") != $table_name) {
            wp_send_json_success(array(
                'documents' => array(),
                'total' => 0,
                'total_size' => 0,
                'tags' => array()
            ));
            return;
        }
        
        // ÏµúÍ∑º Î¨∏ÏÑú Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞
        $documents = $wpdb->get_results(
            "SELECT * FROM $table_name WHERE status = 'active' ORDER BY upload_date DESC LIMIT 100"
        );
        
        // ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
        $total_count = $wpdb->get_var("SELECT COUNT(*) FROM $table_name WHERE status = 'active'");
        $total_size = $wpdb->get_var("SELECT SUM(file_size) FROM $table_name WHERE status = 'active'");
        
        // ÌÉúÍ∑∏ ÏàòÏßë
        $all_tags = array();
        foreach ($documents as $doc) {
            if (!empty($doc->tags)) {
                $tags = explode(',', $doc->tags);
                foreach ($tags as $tag) {
                    $tag = trim($tag);
                    if (!empty($tag)) {
                        $all_tags[] = $tag;
                    }
                }
            }
        }
        $unique_tags = array_unique($all_tags);
        
        wp_send_json_success(array(
            'documents' => $documents,
            'total' => $total_count,
            'total_size' => $total_size ?: 0,
            'tags' => count($unique_tags)
        ));
    }
    
    /**
     * AJAX: Î¨∏ÏÑú ÏÇ≠Ï†ú
     */
    public function ajax_delete_documents() {
        // Nonce Í≤ÄÏ¶ù
        if (!check_ajax_referer('pdf_frontend_nonce', 'nonce', false)) {
            wp_send_json_error('Î≥¥Ïïà Í≤ÄÏ¶ù Ïã§Ìå®');
        }
        
        // Í∂åÌïú ÌôïÏù∏
        if (!current_user_can('manage_options')) {
            wp_send_json_error('Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.');
        }
        
        $file_ids = isset($_POST['file_ids']) ? array_map('sanitize_text_field', $_POST['file_ids']) : array();
        
        if (empty($file_ids)) {
            wp_send_json_error('ÏÇ≠Ï†úÌï† ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§.');
        }
        
        global $wpdb;
        $table_name = $wpdb->prefix . '3chan_pdf_uploads';
        
        // APIÎ•º ÌÜµÌï¥ Í∞Å ÌååÏùº ÏÇ≠Ï†ú
        $settings = get_option('3chan_pdf_manager_settings');
        $api_url = $settings['api_url'];
        $success_count = 0;
        
        foreach ($file_ids as $file_id) {
            // API Ìò∏Ï∂ú
            $response = wp_remote_request($api_url . '/delete-document/?file_id=' . $file_id, array(
                'method' => 'DELETE',
                'timeout' => 30,
                'sslverify' => false
            ));
            
            if (!is_wp_error($response) && wp_remote_retrieve_response_code($response) === 200) {
                // Î°úÏª¨ DBÏóêÏÑúÎèÑ ÏÇ≠Ï†ú
                $wpdb->update(
                    $table_name,
                    array('status' => 'deleted'),
                    array('file_id' => $file_id),
                    array('%s'),
                    array('%s')
                );
                $success_count++;
            }
        }
        
        if ($success_count > 0) {
            wp_send_json_success(array(
                'message' => sprintf('%dÍ∞úÏùò ÌååÏùºÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', $success_count)
            ));
        } else {
            wp_send_json_error('ÌååÏùº ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
        }
    }
    
    /**
     * AJAX: API ÌÖåÏä§Ìä∏
     */
    public function ajax_test_api() {
        // Nonce Í≤ÄÏ¶ù
        if (!check_ajax_referer('pdf_frontend_nonce', 'nonce', false)) {
            wp_send_json_error('Î≥¥Ïïà Í≤ÄÏ¶ù Ïã§Ìå®');
        }
        
        // Í∂åÌïú ÌôïÏù∏
        if (!current_user_can('manage_options')) {
            wp_send_json_error('Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.');
        }
        
        $settings = get_option('3chan_pdf_manager_settings');
        $api_url = $settings['api_url'];
        
        // Health check
        $response = wp_remote_get($api_url . '/health', array(
            'timeout' => 10,
            'sslverify' => false
        ));
        
        if (is_wp_error($response)) {
            wp_send_json_error('API Ïó∞Í≤∞ Ïã§Ìå®: ' . $response->get_error_message());
        }
        
        $status_code = wp_remote_retrieve_response_code($response);
        if ($status_code === 200) {
            wp_send_json_success('API Ïó∞Í≤∞ ÏÑ±Í≥µ!');
        } else {
            wp_send_json_error('API Ïó∞Í≤∞ Ïã§Ìå®: HTTP ' . $status_code);
        }
    }
    
    /**
     * AJAX: Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
     */
    public function ajax_clear_data() {
        // Nonce Í≤ÄÏ¶ù
        if (!check_ajax_referer('pdf_frontend_nonce', 'nonce', false)) {
            wp_send_json_error('Î≥¥Ïïà Í≤ÄÏ¶ù Ïã§Ìå®');
        }
        
        // Í∂åÌïú ÌôïÏù∏
        if (!current_user_can('manage_options')) {
            wp_send_json_error('Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.');
        }
        
        global $wpdb;
        $table_name = $wpdb->prefix . '3chan_pdf_uploads';
        
        // Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º 'deleted' ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω
        $wpdb->update(
            $table_name,
            array('status' => 'deleted'),
            array('status' => 'active'),
            array('%s'),
            array('%s')
        );
        
        wp_send_json_success('Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
    }
}